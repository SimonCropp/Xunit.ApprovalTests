<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /readme.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# <img src="/src/icon.png" height="30px"> Xunit.ApprovalTests

[![Build status](https://ci.appveyor.com/api/projects/status/5x0gasnuhtblvcv2/branch/master?svg=true)](https://ci.appveyor.com/project/SimonCropp/Xunit.ApprovalTests)
[![NuGet Status](https://img.shields.io/nuget/v/Xunit.ApprovalTests.svg?cacheSeconds=86400)](https://www.nuget.org/packages/Xunit.ApprovalTests/)


The default behavior of ApprovalTests uses the [StackTrace](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.stacktrace) to derive the current test and hence compute the name of the approval file. This has several drawbacks/issues:

 * Fragility: Deriving the test name from a stack trace is dependent on several things to be configured correctly. Optimization must be disabled to avoid in-lining and debug symbols enabled and parsable.
 * Performance impact: Computing a stack trace is a relatively expensive operation. Disabling optimization also impacts performance

Xunit.ApprovalTests avoids these problems by using the current xUnit context to derive the approval file name.


<!-- toc -->
## Contents

  * [NuGet package](#nuget-package)
  * [Usage](#usage)
  * [xUnit Theory](#xunit-theory)
  * [AsEnvironmentSpecificTest](#asenvironmentspecifictest)
  * [UseApprovalSubdirectory](#useapprovalsubdirectory)
  * [ForScenario](#forscenario)
  * [Base Class](#base-class)
<!-- endtoc -->



## NuGet package

https://nuget.org/packages/Xunit.ApprovalTests/


## Usage

Usage is done via inheriting from a base class `XunitApprovalBase`

<!-- snippet: XunitApprovalBaseUsage -->
<a id='snippet-xunitapprovalbaseusage'/></a>
```cs
public class Sample :
    XunitApprovalBase
{
    [Fact]
    public void Simple()
    {
        Approvals.Verify("SimpleResult");
    }

    public Sample(ITestOutputHelper testOutput) :
        base(testOutput)
    {
    }
```
<sup>[snippet source](/src/Tests/Snippets/Sample.cs#L6-L20) / [anchor](#snippet-xunitapprovalbaseusage)</sup>
<!-- endsnippet -->


## xUnit Theory

[xUnit Theories](https://xunit.net/docs/getting-started/netfx/visual-studio#write-first-theory) are supported.

<!-- snippet: Theory -->
<a id='snippet-theory'/></a>
```cs
[Theory]
[InlineData("Foo")]
[InlineData(9)]
[InlineData(true)]
public void Theory(object value)
{
    Approvals.Verify(value);
}
```
<sup>[snippet source](/src/Tests/Snippets/Sample.cs#L53-L62) / [anchor](#snippet-theory)</sup>
<!-- endsnippet -->

Will result in the following `.approved.` files:

 * `Sample.Theory_value=Foo.approved.txt`
 * `Sample.Theory_value=9.approved.txt`
 * `Sample.Theory_value=True.approved.txt`


## AsEnvironmentSpecificTest

ApprovalTests `NamerFactory.AsEnvironmentSpecificTest` is supported.

<!-- snippet: AsEnvironmentSpecificTest -->
<a id='snippet-asenvironmentspecifictest'/></a>
```cs
[Fact]
public void AsEnvironmentSpecificTest()
{
    using (NamerFactory.AsEnvironmentSpecificTest("Foo"))
    {
        Approvals.Verify("Value");
    }
}
```
<sup>[snippet source](/src/Tests/Snippets/Sample.cs#L31-L40) / [anchor](#snippet-asenvironmentspecifictest)</sup>
<!-- endsnippet -->

Will result in the following `.approved.` file:

 * `Sample.AsEnvironmentSpecificTest_Foo.approved.txt`


## UseApprovalSubdirectory

ApprovalTests `[UseApprovalSubdirectory]` is supported.

<!-- snippet: UseApprovalSubdirectory -->
<a id='snippet-useapprovalsubdirectory'/></a>
```cs
[Fact]
[UseApprovalSubdirectory("SubDir")]
public void InSubDir()
{
    Approvals.Verify("SimpleResult");
}
```
<sup>[snippet source](/src/Tests/Snippets/Sample.cs#L22-L29) / [anchor](#snippet-useapprovalsubdirectory)</sup>
<!-- endsnippet -->

Will result in the following `.approved.` file:

 * `SubDir\Sample.InSubDir.approved.txt`


## ForScenario

ApprovalTests `ApprovalResults.ForScenario` is supported.

<!-- snippet: ForScenario -->
<a id='snippet-forscenario'/></a>
```cs
[Fact]
public void ForScenarioTest()
{
    using (ApprovalResults.ForScenario("Name"))
    {
        Approvals.Verify("Value");
    }
}
```
<sup>[snippet source](/src/Tests/Snippets/Sample.cs#L42-L51) / [anchor](#snippet-forscenario)</sup>
<!-- endsnippet -->

Will result in the following `.approved.` file:

 * `Sample.ForScenarioTest_ForScenario.Name.approved.txt`


## Base Class

When creating a custom base class for other tests, it is necessary to pass through the source file path to `XunitApprovalBase` via the constructor.

<!-- snippet: XunitApprovalCustomBase -->
<a id='snippet-xunitapprovalcustombase'/></a>
```cs
public class CustomBase :
    XunitApprovalBase
{
    public CustomBase(
        ITestOutputHelper testOutput,
        [CallerFilePath] string sourceFile = "") :
        base(testOutput, sourceFile)
    {
    }
}
```
<sup>[snippet source](/src/Tests/Snippets/CustomBase.cs#L4-L15) / [anchor](#snippet-xunitapprovalcustombase)</sup>
<!-- endsnippet -->


## Release Notes

See [closed milestones](../../milestones?state=closed).


## Icon

[Wolverine](https://thenounproject.com/term/wolverine/18415/) designed by [Mike Rowe](https://thenounproject.com/itsmikerowe/) from [The Noun Project](https://thenounproject.com/).
